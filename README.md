# 代替機管理システム (Google Apps Script Web App)

## 概要
Google Apps Script (GAS) を使用した代替機管理システムです。スプレッドシートのデータを閲覧・編集できるWebアプリケーションとして動作し、高速なデータアクセスと直感的なユーザーインターフェースを提供します。

## 主な機能

### 基本機能
- **ダッシュボード**: 各機能へのナビゲーション
- **スプレッドシートビューアー**: 各拠点のデータを閲覧・編集（拠点管理番号をシート名として使用）
- **ドラッグ&ドロップ**: テーブルの列を自由に並び替え
- **ステータス管理**: 貸出機器のステータスをリアルタイムで更新

### 新機能（v2.0）
- **オープニング画面**: 起動時に美しいローディング画面を表示
- **データプリロード**: 全拠点のデータを事前読み込みして高速表示
- **更新ボタン**: 選択中拠点のデータを手動で最新化
- **エラーハンドリング**: スプレッドシートID未設定拠点の適切な処理
- **データフィルタリング**: 貸出中データがない場合の「なし」表示
- **パフォーマンス最適化**: プリロードデータ活用による高速表示

### 新機能（v2.1）
- **拠点管理番号シート対応**: 拠点管理番号（osaka_desktop、kobe等）を直接シート名として使用

### 新機能（v2.2）
- **拠点管理番号ドリルダウン機能**: mainシートの一覧から拠点管理番号をクリックして代替機フォーム回答シートを表示
- **戻るボタン**: 代替機フォーム回答シートから一覧へ簡単に戻れるナビゲーション
- **インタラクティブUI**: 拠点管理番号リンクのホバーエフェクトとクリック体験を向上
- **セル編集機能**: 代替機フォーム回答シート内の任意のセルをクリックして編集可能（mainシートは数式により自動更新のため編集不可）

## ファイル構造
```
├── Index.html                       # メインのHTMLファイル
├── Code.gs                          # Google Apps Scriptのサーバーサイドコード
├── styles.html                      # グローバルスタイルシート
├── dashboard-styles.html            # ダッシュボード専用スタイル
├── spreadsheet-styles.html          # スプレッドシート専用スタイル
├── opening-screen-styles.html       # オープニング画面専用スタイル
├── navigation.html                  # ナビゲーションバーコンポーネント
├── dashboard.html                   # ダッシュボードページ
├── spreadsheet.html                 # スプレッドシートビューアーページ
├── opening-screen.html              # オープニング画面コンポーネント
├── coming-soon.html                 # 準備中ページテンプレート
├── main.html                        # メインJavaScriptコード
├── spreadsheet-functions.html       # スプレッドシート関連JavaScript
├── opening-screen-functions.html    # オープニング画面・プリロード機能
├── drag-drop-functions.html         # ドラッグ&ドロップ関連JavaScript
└── README.md                        # このファイル
```

## セットアップ方法

### 1. プロジェクトの作成
1. [Google Apps Script](https://script.google.com/) にアクセス
2. 新しいプロジェクトを作成
3. すべてのファイルをプロジェクトにアップロード

### 2. スクリプトプロパティの設定
スクリプトプロパティに各拠点のスプレッドシートIDを設定してください：

| プロパティキー | 対応拠点 | 必須 |
|---|---|---|
| `SPREADSHEET_ID_SOURCE_OSAKA_DESKTOP` | 大阪(デスクトップ) | ○ |
| `SPREADSHEET_ID_SOURCE_OSAKA_LAPTOP` | 大阪(ノート、サーバー) | ○ |
| `SPREADSHEET_ID_SOURCE_KOBE` | 神戸(端末) | ○ |
| `SPREADSHEET_ID_SOURCE_HIMEJI` | 姫路(端末) | ○ |
| `SPREADSHEET_ID_SOURCE_OSAKA_PRINTER` | 大阪(プリンタ、その他) | ○ |
| `SPREADSHEET_ID_SOURCE_HYOGO_PRINTER` | 兵庫(プリンタ、その他) | ○ |

**注意**: 未設定の拠点があっても動作しますが、該当拠点選択時にエラーメッセージが表示されます。

### 2.1. スプレッドシート構造の要件
各拠点のスプレッドシートは以下の構造である必要があります：

- **mainシート**: 代替機一覧が集約されたメインシート（1行目にヘッダー行、2行目以降にデータ行）
- **代替機フォーム回答シート**: 各拠点の詳細データ用シート（例：`osaka_desktop`、`kobe`、`himeji`など）
- **列構成**: システムが期待する列構成に合わせてください

**機能の流れ:**
1. 拠点を選択するとmainシートの一覧が表示されます（数式により自動更新、編集不可）
2. 一覧内の拠点管理番号をクリックすると、その拠点管理番号と同名の代替機フォーム回答シートが表示されます
3. 代替機フォーム回答シート内の任意のセルをクリックして編集できます
4. 戻るボタンで一覧に戻ることができます（編集内容はmainシートに自動反映）

例）拠点管理番号が `osaka_desktop` の場合：
- mainシートの一覧で `osaka_desktop` をクリック
- スプレッドシート内の `osaka_desktop` 代替機フォーム回答シートの詳細データが表示される
- セルをクリックして内容を編集可能

### 3. デプロイ
1. Google Apps Scriptエディタで「デプロイ」→「新しいデプロイ」を選択
2. 種類を「ウェブアプリ」に設定
3. 実行ユーザーとアクセス権限を適切に設定
4. デプロイしてWebアプリURLを取得

## 使用方法

### 基本的な操作
1. **起動**: WebアプリURLにアクセス
2. **データ読み込み**: オープニング画面で全拠点データが自動読み込み
3. **拠点選択**: スプレッドシートビューアーで拠点を選択
4. **データ表示**: プリロードデータにより高速表示
5. **データ更新**: 更新ボタンで最新データを取得

### 高度な機能
- **フィルタリング**: 「一覧」「貸出中」でデータを絞り込み
- **拠点ドリルダウン**: 一覧から拠点管理番号をクリックして代替機フォーム回答シートを表示
- **セル編集**: 代替機フォーム回答シート内のセルをクリックして内容を編集（mainシートは数式により自動更新）

## 開発時の注意点

### プロジェクトルール

#### **スタイル・テーマ統一規則**
- **基調カラー**: ナビゲーションのハイライトカラー（`--highlight-color: #3b82f6`）に統一
- **グラデーション**: `--highlight-gradient: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)`を使用
- **シャドウ**: インタラクション時は`--shadow-blue: 0 4px 14px 0 rgba(59, 130, 246, 0.15)`を使用
- **一貫性**: 全てのボタン、リンク、フォーカス状態は同一カラーテーマで統一
- **カスタムカラー禁止**: CSS変数で定義されていない独自カラーの使用を避ける

#### **カラーパレット**
```css
--highlight-color: #3b82f6      /* メインのハイライトカラー */
--highlight-gradient: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)
--shadow-blue: 0 4px 14px 0 rgba(59, 130, 246, 0.15)
```

### デバッグモード
- **制御場所**: `main.html` の `DEBUG_MODE` 変数
- **開発時**: `DEBUG_MODE = true`（詳細ログ出力）
- **本番時**: `DEBUG_MODE = false`（パフォーマンス優先）

### パフォーマンス設定
- **サーバーサイド**: `Code.gs` の `DEBUG` 定数で制御
- **プリロード**: オープニング画面で自動実行
- **キャッシュ**: プリロードデータを活用して高速表示

### エラーハンドリング
- スプレッドシートID未設定拠点は警告表示
- 通信エラー時は適切なエラーメッセージ表示
- データなし時は「なし」メッセージ表示

### 新機能の追加
- **ページ追加**: `navigation.html` にリンクを追加
- **スタイル追加**: 専用スタイルファイルを作成
- **JavaScript追加**: 機能別ファイルに分割

## システム要件
- Google Apps Script環境
- モダンブラウザ（Chrome、Firefox、Safari、Edge）
- インターネット接続

## トラブルシューティング

### よくある問題
1. **オープニング画面が表示されない**
   - ブラウザのJavaScriptが有効か確認
   - ファイルが正しくアップロードされているか確認

2. **拠点データが表示されない**
   - スクリプトプロパティの設定を確認
   - スプレッドシートIDが正しいか確認
   - スプレッドシートの共有設定を確認

3. **更新ボタンが動作しない**
   - 拠点が選択されているか確認
   - ネットワーク接続を確認

4. **パフォーマンスが低下している**
   - DEBUG_MODE を false に設定
   - ブラウザのキャッシュをクリア

### サポート情報
- **ログ確認**: デバッグモードでコンソールログを確認
- **エラー詳細**: エラーメッセージの詳細を確認
- **プリロード状況**: オープニング画面の進捗を確認

## 今後の拡張予定
- [ ] フォーム作成機能

## 更新履歴
- **v2.2**: 拠点管理番号ドリルダウン機能とナビゲーション機能を追加
- **v2.1**: 拠点管理番号をシート名として直接使用するよう機能改善
- **v2.0**: オープニング画面、プリロード機能、更新ボタン、エラーハンドリング強化
- **v1.0**: 基本的なスプレッドシートビューアー機能

## ライセンス
内部利用のみ