# シート構造詳細設計書

この文書は、代替機管理システムの各 Google Sheets シートの詳細な構造を定義します。

## 1. マスタシート構造

### 1.1 端末マスタ

#### 概要

端末機器（Server、Desktop、Laptop、Tablet）の管理情報を格納するマスタシート。

#### 列構造

| 列番号 | 列名             | データ型 | 必須 | 説明                                     | 例                            |
| ------ | ---------------- | -------- | ---- | ---------------------------------------- | ----------------------------- |
| A      | 拠点管理番号     | String   | ✓    | 機器固有識別子                           | OSAKA_SV_ThinkPad_ABC123_001  |
| B      | カテゴリ         | String   | ✓    | 機器分類（Server/Desktop/Laptop/Tablet） | Server                        |
| C      | 機種名           | String   | ✓    | 機種マスタから選択                       | ThinkPad X1 Carbon            |
| D      | 資産管理番号     | String   |      | 会社の資産番号                           | ASSET_001                     |
| E      | 製造番号         | String   | ✓    | シリアルナンバー                         | ABC123456                     |
| F      | ソフトウェア     | String   |      | インストールソフト                       | Office 2021                   |
| G      | OS               | String   |      | オペレーティングシステム                 | Windows 11                    |
| H      | 登録日           | String   | ✓    | レコード登録日                           | 2024/07/15                    |
| I      | 更新日           | String   |      | 最終更新日                               | 2024/07/20                    |
| J      | formURL          | String   |      | 個別フォーム URL                         | https://forms.google.com/...  |
| K      | 共通フォーム URL | String   |      | 共通フォーム URL                         | https://forms.google.com/...  |
| L      | QR コード URL    | String   |      | QR コード用 URL                          | https://script.google.com/... |

#### 制約・ルール

- **拠点管理番号**: システム全体で一意、5 セクション構成
- **カテゴリ**: Server, Desktop, Laptop, Tablet のみ有効
- **機種名**: 機種マスタに存在する機種名のみ
- **代替機種別**: SV（Server）、CL（Client）の分類
- **URL フィールド**: HTTP/HTTPS 形式、自動生成

### 1.2 プリンタマスタ

#### 概要

プリンタ機器の管理情報を格納するマスタシート。

#### 列構造

| 列番号 | 列名             | データ型 | 必須 | 説明                     | 例                            |
| ------ | ---------------- | -------- | ---- | ------------------------ | ----------------------------- |
| A      | 拠点管理番号     | String   | ✓    | 機器固有識別子           | OSAKA_Printer_MFP_XYZ123_001  |
| B      | カテゴリ         | String   | ✓    | 機器分類（Printer 固定） | Printer                       |
| C      | 機種名           | String   | ✓    | 機種マスタから選択       | imageCLASS MF644Cdw           |
| D      | 製造番号         | String   | ✓    | シリアルナンバー         | XYZ123456                     |
| E      | 代替機種別       | String   |      | 代替機のカテゴリ分類     | プリンタ                      |
| F      | 登録日           | String   | ✓    | レコード登録日           | 2024/07/15                    |
| G      | 更新日           | String   |      | 最終更新日               | 2024/07/20                    |
| H      | formURL          | String   |      | 個別フォーム URL         | https://forms.google.com/...  |
| I      | 共通フォーム URL | String   |      | 共通フォーム URL         | https://forms.google.com/...  |
| J      | QR コード URL    | String   |      | QR コード用 URL          | https://script.google.com/... |

#### 制約・ルール

- **拠点管理番号**: システム全体で一意、5 セクション構成
- **カテゴリ**: Printer 固定
- **機種名**: 機種マスタに存在する機種名のみ
- **代替機種別**: プリンタ固定
- **URL フィールド**: HTTP/HTTPS 形式、自動生成

### 1.3 その他マスタ

#### 概要

Router、Hub、その他機器の管理情報を格納するマスタシート。

#### 列構造

| 列番号 | 列名             | データ型 | 必須 | 説明                         | 例                            |
| ------ | ---------------- | -------- | ---- | ---------------------------- | ----------------------------- |
| A      | 拠点管理番号     | String   | ✓    | 機器固有識別子               | OSAKA_Router_WXR_DEF789_001   |
| B      | カテゴリ         | String   | ✓    | 機器分類（Router/Hub/Other） | Router                        |
| C      | 機種名           | String   | ✓    | 機種マスタから選択           | WXR-6000AX12S                 |
| D      | 製造番号         | String   | ✓    | シリアルナンバー             | DEF789456                     |
| E      | 代替機種別       | String   |      | 代替機のカテゴリ分類         | その他                        |
| F      | 登録日           | String   | ✓    | レコード登録日               | 2024/07/15                    |
| G      | 更新日           | String   |      | 最終更新日                   | 2024/07/20                    |
| H      | formURL          | String   |      | 個別フォーム URL             | https://forms.google.com/...  |
| I      | 共通フォーム URL | String   |      | 共通フォーム URL             | https://forms.google.com/...  |
| J      | QR コード URL    | String   |      | QR コード用 URL              | https://script.google.com/... |

#### 制約・ルール

- **拠点管理番号**: システム全体で一意、5 セクション構成
- **カテゴリ**: Router, Hub, Other のみ有効
- **機種名**: 機種マスタに存在する機種名のみ
- **代替機種別**: その他固定
- **URL フィールド**: HTTP/HTTPS 形式、自動生成

### 1.4 拠点マスタ

#### 概要

拠点情報と管轄情報を管理するマスタシート。

#### 列構造

| 列番号 | 列名                   | データ型 | 必須 | 説明                           | 例                     |
| ------ | ---------------------- | -------- | ---- | ------------------------------ | ---------------------- |
| A      | 拠点 ID                | String   | ✓    | 拠点識別子（小文字英数字）     | osaka                  |
| B      | 拠点名                 | String   | ✓    | 拠点の正式名称                 | 大阪営業所             |
| C      | 拠点コード             | String   | ✓    | 拠点管理番号用コード（大文字） | OSAKA                  |
| D      | 管轄                   | String   | ✓    | 管轄エリア                     | 関西                   |
| E      | グループメールアドレス | Email    | ✓    | 課のグループメール             | test-group@example.com |
| F      | ステータス変更通知     | Boolean  | ✓    | 通知 ON/OFF                    | true                   |
| G      | ステータス             | String   | ✓    | 有効/無効                      | active                 |
| H      | 作成日                 | DateTime | ✓    | レコード作成日時               | 2024/07/02 14:30:00    |
| I      | 更新日                 | DateTime | ✓    | 最終更新日時                   | 2024/07/02 14:30:00    |

#### 制約・ルール

- **拠点 ID**: 小文字英数字のみ、20 文字以内、ユニーク
- **拠点コード**: 大文字英語のみ、20 文字以内、ユニーク
- **管轄**: 自由入力（関西、関東、九州等）
- **グループメールアドレス**: メール形式バリデーション
- **ステータス変更通知**: true/false、デフォルト false
- **ステータス**: active/inactive
- **日時フィールド**: yyyy/MM/dd HH:mm:ss 形式

### 1.5 機種マスタ

#### 概要

機器の機種情報を管理するマスタシート。

#### 列構造

| 列番号 | 列名     | データ型 | 必須 | 説明                               | 例                 |
| ------ | -------- | -------- | ---- | ---------------------------------- | ------------------ |
| A      | 機種 ID  | String   | ✓    | 自動生成 ID                        | MODEL_001          |
| B      | 機種名   | String   | ✓    | 機種の正式名称（ハイフン使用推奨） | ThinkPad-X1-Carbon |
| C      | メーカー | String   | ✓    | 製造メーカー名                     | Lenovo             |
| D      | カテゴリ | String   | ✓    | 機器カテゴリ（頭文字大文字）       | Desktop            |
| E      | 登録日   | String   | ✓    | レコード登録日                     | 2024/07/15         |
| F      | 更新日   | String   |      | 最終更新日                         | 2024/07/20         |
| G      | 備考     | String   |      | 補足情報                           | 第 10 世代         |

#### 制約・ルール

- **機種 ID**: 自動生成、ユニーク
- **機種名**: スペース禁止、ハイフン使用、アンダースコア禁止
- **カテゴリ**: Desktop, Laptop, Server, Tablet, Printer, Router, Hub, Other
- **日時フィールド**: yyyy/MM/dd HH:mm:ss 形式

#### カテゴリマスタ

| カテゴリ（英語） | カテゴリ（日本語） | 説明                       |
| ---------------- | ------------------ | -------------------------- |
| Desktop          | デスクトップ PC    | デスクトップコンピュータ   |
| Laptop           | ノート PC          | ノートパソコン             |
| Server           | サーバー           | サーバー機器               |
| Tablet           | タブレット         | タブレット端末             |
| Printer          | プリンタ           | プリンター機器             |
| Router           | ルーター           | ネットワークルーター       |
| Hub              | ハブ               | ネットワークハブ・スイッチ |
| Other            | その他             | その他機器                 |

## 2. ステータス収集シート構造

### 2.1 端末ステータス収集

#### 概要

Google Forms から端末に関する回答を直接受信するシート。onFormSubmit トリガーが設定され、回答受信時に通知処理を実行。

#### 列構造

| 列番号 | 列名                                       | データ型 | 説明                         | 例                           |
| ------ | ------------------------------------------ | -------- | ---------------------------- | ---------------------------- |
| A      | タイムスタンプ                             | DateTime | フォーム送信日時（自動記録） | 2024/07/02 14:30:00          |
| B      | 9999.管理 ID                               | String   | 内部管理用 ID                | MGMT_001                     |
| C      | 0-0.拠点管理番号                           | String   | 機器固有識別子               | OSAKA_SV_ThinkPad_ABC123_001 |
| D      | 0-1.担当者                                 | String   | 担当者名                     | 山田太郎                     |
| E      | 0-2.EM システムズの社員ですか？            | String   | 社員判定                     | はい                         |
| F      | 0-3.所属会社                               | String   | 所属会社名                   | EM システムズ株式会社        |
| G      | 0-4.ステータス                             | String   | 機器の現在状態               | 1.貸出中                     |
| H      | 1-1.顧客名または貸出先                     | String   | 貸出先情報                   | ○○ 商事株式会社              |
| I      | 1-2.顧客番号                               | String   | 顧客管理番号                 | CUST_001                     |
| J      | 1-3.住所                                   | String   | 貸出先住所                   | 大阪市北区...                |
| K      | 1-4.ユーザー機の預り有無                   | String   | 預り機の有無                 | 有り                         |
| L      | 1-5.依頼者                                 | String   | 依頼者名                     | 田中花子                     |
| M      | 1-6.備考                                   | String   | 貸出時備考                   | 修理期間中の代替機           |
| N      | 1-7.預りユーザー機のシリアル No.(製造番号) | String   | 預かった機器のシリアル番号   | USER_ABC123                  |
| O      | 1-8.お預かり証 No.                         | String   | 預かり証番号                 | RECEIPT_001                  |
| P      | 2-1.預り機返却の有無                       | String   | 預り機返却状況               | 無し                         |
| Q      | 2-2.依頼者                                 | String   | 返却依頼者名                 | 佐藤次郎                     |
| R      | 2-3.備考                                   | String   | 返却時備考                   | 修理完了                     |
| S      | 3-0.社内ステータス                         | String   | 社内での状態                 | 修理中                       |
| T      | 3-0-1.棚卸しフラグ                         | String   | 棚卸し対象フラグ             | 対象                         |
| U      | 3-0-2.拠点                                 | String   | 現在の拠点                   | 大阪                         |
| V      | 3-1-1.ソフト                               | String   | ソフトウェア情報             | Office 2021                  |
| W      | 3-1-2.備考                                 | String   | ソフト関連備考               | ライセンス更新済み           |
| X      | 3-2-1.端末初期化の引継ぎ                   | String   | 初期化引継ぎ情報             | 実施済み                     |
| Y      | 3-2-2.備考                                 | String   | 初期化備考                   | データ削除確認済み           |
| Z      | 3-2-3.引継ぎ担当者                         | String   | 引継ぎ担当者名               | 鈴木三郎                     |
| AA     | 3-2-4.初期化作業の引継ぎ                   | String   | 初期化作業引継ぎ             | 完了                         |
| AB     | 4-1.所在                                   | String   | 機器の所在地                 | 本社倉庫                     |
| AC     | 4-2.持ち出し理由                           | String   | 持ち出し理由                 | 客先デモ                     |
| AD     | 4-3.備考                                   | String   | 持ち出し備考                 | 2024/07/15 返却予定          |
| AE     | 5-1.内容                                   | String   | その他内容                   | 特記事項なし                 |
| AF     | 5-2.所在                                   | String   | その他所在                   | 支店倉庫                     |
| AG     | 5-3.備考                                   | String   | その他備考                   | 要確認                       |

### 2.2 プリンタその他ステータス収集

#### 概要

Google Forms からプリンタに関する回答を直接受信するシート。端末と同様に onFormSubmit トリガーが設定。

#### 列構造

| 列番号 | 列名                                       | データ型 | 説明                         | 例                           |
| ------ | ------------------------------------------ | -------- | ---------------------------- | ---------------------------- |
| A      | タイムスタンプ                             | DateTime | フォーム送信日時（自動記録） | 2024/07/02 14:30:00          |
| B      | 9999.管理 ID                               | String   | 内部管理用 ID                | MGMT_P001                    |
| C      | 0-0.拠点管理番号                           | String   | 機器固有識別子               | OSAKA_Printer_MFP_XYZ123_001 |
| D      | 0-1.担当者                                 | String   | 担当者名                     | 山田太郎                     |
| E      | 0-2.EM システムズの社員ですか？            | String   | 社員判定                     | はい                         |
| F      | 0-3.所属会社                               | String   | 所属会社名                   | EM システムズ株式会社        |
| G      | 0-4.ステータス                             | String   | 機器の現在状態               | 2.回収後社内保管             |
| H      | 1-1.顧客名または貸出先                     | String   | 貸出先情報                   | ○○ 商事株式会社              |
| I      | 1-2.顧客番号                               | String   | 顧客管理番号                 | CUST_001                     |
| J      | 1-3.住所                                   | String   | 貸出先住所                   | 大阪市北区...                |
| K      | 1-4.ユーザー機の預り有無                   | String   | 預り機の有無                 | 有り                         |
| L      | 1-5.依頼者                                 | String   | 依頼者名                     | 田中花子                     |
| M      | 1-6.備考                                   | String   | 貸出時備考                   | 修理期間中の代替機           |
| N      | 1-7.預りユーザー機のシリアル No.(製造番号) | String   | 預かった機器のシリアル番号   | USER_XYZ789                  |
| O      | 2-1.預り機返却の有無                       | String   | 預り機返却状況               | 無し                         |
| P      | 2-2.備考                                   | String   | 返却時備考                   | 修理完了                     |
| Q      | 2-3.修理の必要性                           | String   | 修理要否                     | 要修理                       |
| R      | 2-4.備考                                   | String   | 修理関連備考                 | トナー交換必要               |
| S      | 3-0.社内ステータス                         | String   | 社内での状態                 | 修理待ち                     |
| T      | 3-0-1.棚卸フラグ                           | String   | 棚卸し対象フラグ             | 対象                         |
| U      | 3-0-2.拠点                                 | String   | 現在の拠点                   | 大阪                         |
| V      | 3-1-1.備考                                 | String   | 社内ステータス備考           | 部品待ち                     |
| W      | 3-2-1.修理依頼の引継ぎ                     | String   | 修理引継ぎ情報               | 実施済み                     |
| X      | 3-2-2.症状                                 | String   | 故障症状                     | 印刷不良                     |
| Y      | 3-2-3.備考                                 | String   | 修理引継ぎ備考               | メーカー修理必要             |
| Z      | 4-1. 所在                                  | String   | 修理時所在地                 | 修理センター                 |
| AA     | 4-2.修理内容                               | String   | 修理内容                     | ドラム交換                   |
| AB     | 4-3.備考                                   | String   | 修理備考                     | 保証期間内                   |
| AC     | 5-1.所在                                   | String   | 持ち出し所在                 | 本社                         |
| AD     | 5-2.持ち出し理由                           | String   | 持ち出し理由                 | 客先デモ                     |
| AE     | 5-3.備考                                   | String   | 持ち出し備考                 | 2024/07/20 返却予定          |
| AF     | 6-1.所在                                   | String   | 廃棄時所在                   | 廃棄場                       |
| AG     | 6-2.依頼者                                 | String   | 廃棄依頼者                   | 管理部                       |
| AH     | 6-3.備考                                   | String   | 廃棄備考                     | 適正廃棄完了                 |
| AI     | 7-1.内容                                   | String   | その他内容                   | 特記事項なし                 |
| AJ     | 7-2.所在                                   | String   | その他所在                   | 支店倉庫                     |
| AK     | 7-3.備考                                   | String   | その他備考                   | 要確認                       |

## 3. ステータス定義

### 3.1 共通ステータス（0-4.ステータス）

| ステータス値     | 説明                     | 適用範囲               |
| ---------------- | ------------------------ | ---------------------- |
| 1.貸出中         | 顧客先に貸出している状態 | 端末・プリンタ         |
| 2.回収後社内保管 | 回収済み、社内で保管中   | 端末・プリンタ         |
| 3.社内にて保管中 | 社内での保管・管理中     | 端末・プリンタ・その他 |
| 4.社外持ち出し中 | 社外への持ち出し中       | 端末・プリンタ・その他 |
| 5.機器売却・廃棄 | 売却または廃棄済み       | 端末・プリンタ・その他 |
| 6.紛失・盗難     | 紛失または盗難発生       | 端末・プリンタ・その他 |
| 7.その他         | その他の状態             | 端末・プリンタ・その他 |

### 3.2 社内ステータス（3-0.社内ステータス）

| ステータス値 | 説明               | 適用範囲               |
| ------------ | ------------------ | ---------------------- |
| 1.修理中     | 修理作業中         | 端末・プリンタ         |
| 2.初期化中   | データ初期化作業中 | 端末                   |
| 3.設定中     | 各種設定作業中     | 端末・プリンタ         |
| 4.棚卸し対象 | 棚卸し対象機器     | 端末・プリンタ・その他 |
| 5.貸出可能   | 貸出可能状態       | 端末・プリンタ・その他 |

## 4. 注意事項

### 4.1 データ連携

- **マスタシート**: 手動入力または一括インポート
- **収集シート**: Google Forms からの自動入力のみ
- **データ同期**: マスタ → 収集シートへの参照あり、逆はなし

### 4.2 拡張性

- 各シートは必要に応じて列の追加が可能
- ステータス値は設定により追加・変更可能
- フォーム構造の変更に応じて収集シート構造も調整が必要

### 4.3 データ整合性

- 拠点管理番号はシステム全体で一意性を保つ
- 機種名は機種マスタとの整合性を保つ
- ステータス値は定義された値のみ使用

### 4.4 バックアップ・保守

- 収集シートは 3 年経過後のデータローテーション対象
- マスタシートは永続保持
- 定期的なデータ整合性チェックが推奨

## 5. ビューシート構造

### 5.1 統合ビューシート（分離版）

#### 概要

2025 年 1 月に統合ビューを端末系とプリンタ・その他系に分離。各系統の特徴に最適化された表示を提供し、データタイプマスタとの連携により動的な表示制御を実現。

#### 5.1.1 端末系統合ビューシート（integrated_view_terminal）

##### 対象機器

- Server（サーバー）
- Desktop（デスクトップ）
- Laptop（ラップトップ）
- Tablet（タブレット）

##### 列構造

| 列番号 | 列名                                       | データ型 | データソース                 | 説明                             | 例                            |
| ------ | ------------------------------------------ | -------- | ---------------------------- | -------------------------------- | ----------------------------- |
| A      | 拠点管理番号                               | String   | マスタ                       | 機器固有識別子                   | OSAKA_SV_ThinkPad_ABC123_001  |
| B      | カテゴリ                                   | String   | マスタ                       | 機器分類（端末系のみ）           | Server                        |
| C      | 機種名                                     | String   | マスタ                       | 機種マスタから取得               | ThinkPad X1 Carbon            |
| D      | 製造番号                                   | String   | マスタ                       | シリアルナンバー                 | ABC123456                     |
| E      | 資産管理番号                               | String   | マスタ                       | 会社の資産番号                   | ASSET_001                     |
| F      | ソフトウェア                               | String   | マスタ                       | インストールソフト               | Office 2021                   |
| G      | OS                                         | String   | マスタ                       | オペレーティングシステム         | Windows 11                    |
| H      | タイムスタンプ                             | DateTime | フォーム送信日時（自動記録） | 2024/07/02 14:30:00              |
| I      | 9999.管理 ID                               | String   | 内部管理用 ID                | MGMT_001                         |
| J      | 0-0.拠点管理番号                           | String   | 機器固有識別子               | OSAKA_SV_ThinkPad_ABC123_001     |
| K      | 0-1.担当者                                 | String   | 担当者名                     | 山田太郎                         |
| L      | 0-2.EM システムズの社員ですか？            | String   | 社員判定                     | はい                             |
| M      | 0-3.所属会社                               | String   | 所属会社名                   | EM システムズ株式会社            |
| N      | 0-4.ステータス                             | String   | 機器の現在状態               | 1.貸出中                         |
| O      | 1-1.顧客名または貸出先                     | String   | 貸出先情報                   | ○○ 商事株式会社                  |
| P      | 1-2.顧客番号                               | String   | 顧客管理番号                 | CUST_001                         |
| Q      | 1-3.住所                                   | String   | 貸出先住所                   | 大阪市北区...                    |
| R      | 1-4.ユーザー機の預り有無                   | String   | 預り機の有無                 | 有り                             |
| S      | 1-5.依頼者                                 | String   | 依頼者名                     | 田中花子                         |
| T      | 1-6.備考                                   | String   | 貸出時備考                   | 修理期間中の代替機               |
| U      | 1-7.預りユーザー機のシリアル No.(製造番号) | String   | 預かった機器のシリアル番号   | USER_ABC123                      |
| V      | 1-8.お預かり証 No.                         | String   | 預かり証番号                 | RECEIPT_001                      |
| W      | 2-1.預り機返却の有無                       | String   | 預り機返却状況               | 無し                             |
| X      | 2-2.依頼者                                 | String   | 返却依頼者名                 | 佐藤次郎                         |
| Y      | 2-3.備考                                   | String   | 返却時備考                   | 修理完了                         |
| Z      | 3-0.社内ステータス                         | String   | 社内での状態                 | 修理中                           |
| AA     | 3-0-1.棚卸しフラグ                         | String   | 棚卸し対象フラグ             | 対象                             |
| AB     | 3-0-2.拠点                                 | String   | 現在の拠点                   | 大阪                             |
| AC     | 3-1-1.ソフト                               | String   | ソフトウェア情報             | Office 2021                      |
| AD     | 3-1-2.備考                                 | String   | ソフト関連備考               | ライセンス更新済み               |
| AE     | 3-2-1.端末初期化の引継ぎ                   | String   | 初期化引継ぎ情報             | 実施済み                         |
| AF     | 3-2-2.備考                                 | String   | 初期化備考                   | データ削除確認済み               |
| AG     | 3-2-3.引継ぎ担当者                         | String   | 引継ぎ担当者名               | 鈴木三郎                         |
| AH     | 3-2-4.初期化作業の引継ぎ                   | String   | 初期化作業引継ぎ             | 完了                             |
| AI     | 4-1.所在                                   | String   | 機器の所在地                 | 本社倉庫                         |
| AJ     | 4-2.持ち出し理由                           | String   | 持ち出し理由                 | 客先デモ                         |
| AK     | 4-3.備考                                   | String   | 持ち出し備考                 | 2024/07/15 返却予定              |
| AL     | 5-1.内容                                   | String   | その他内容                   | 特記事項なし                     |
| AM     | 5-2.所在                                   | String   | その他所在                   | 支店倉庫                         |
| AN     | 5-3.備考                                   | String   | その他備考                   | 要確認                           |
| AO     | 貸出日数                                   | Number   | 計算フィールド               | 貸出中の場合の経過日数           | 90                            |
| AP     | 要注意フラグ                               | Boolean  | 計算フィールド               | 長期貸出等の注意が必要な状態     | TRUE                          |
| AQ     | 拠点名                                     | String   | 拠点マスタ参照               | 拠点コードから拠点名を取得       | 大阪営業所                    |
| AR     | 管轄                                       | String   | 拠点マスタ参照               | 拠点の管轄エリア                 | 関西                          |
| AS     | formURL                                    | String   | マスタ                       | 個別フォーム URL                 | https://forms.google.com/...  |
| AT     | QR コード URL                              | String   | マスタ                       | QR コード用 URL                  | https://script.google.com/... |

#### 5.1.2 プリンタ・その他系統合ビューシート（integrated_view_printer_other）

##### 対象機器

- Printer（プリンタ）
- Router（ルーター）
- Hub（ハブ）
- Other（その他）

##### 列構造

| 列番号 | 列名                                       | データ型 | データソース                 | 説明                           | 例                            |
| ------ | ------------------------------------------ | -------- | ---------------------------- | ------------------------------ | ----------------------------- |
| A      | 拠点管理番号                               | String   | マスタ                       | 機器固有識別子                 | OSAKA_PR_MFP_XYZ789_001      |
| B      | カテゴリ                                   | String   | マスタ                       | 機器分類（プリンタ・その他系） | Printer                       |
| C      | 機種名                                     | String   | マスタ                       | 機種マスタから取得             | DocuCentre-VII C3373          |
| D      | 製造番号                                   | String   | マスタ                       | シリアルナンバー               | XYZ789012                     |
| E      | タイムスタンプ                             | DateTime | フォーム送信日時（自動記録） | 2024/07/02 14:30:00            |
| F      | 9999.管理 ID                               | String   | 内部管理用 ID                | MGMT_P001                      |
| G      | 0-0.拠点管理番号                           | String   | 機器固有識別子               | OSAKA_Printer_MFP_XYZ123_001   |
| H      | 0-1.担当者                                 | String   | 担当者名                     | 山田太郎                       |
| I      | 0-2.EM システムズの社員ですか？            | String   | 社員判定                     | はい                           |
| J      | 0-3.所属会社                               | String   | 所属会社名                   | EM システムズ株式会社          |
| K      | 0-4.ステータス                             | String   | 機器の現在状態               | 2.回収後社内保管               |
| L      | 1-1.顧客名または貸出先                     | String   | 貸出先情報                   | ○○ 商事株式会社                |
| M      | 1-2.顧客番号                               | String   | 顧客管理番号                 | CUST_001                       |
| N      | 1-3.住所                                   | String   | 貸出先住所                   | 大阪市北区...                  |
| O      | 1-4.ユーザー機の預り有無                   | String   | 預り機の有無                 | 有り                           |
| P      | 1-5.依頼者                                 | String   | 依頼者名                     | 田中花子                       |
| Q      | 1-6.備考                                   | String   | 貸出時備考                   | 修理期間中の代替機             |
| R      | 1-7.預りユーザー機のシリアル No.(製造番号) | String   | 預かった機器のシリアル番号   | USER_XYZ789                    |
| S      | 2-1.預り機返却の有無                       | String   | 預り機返却状況               | 無し                           |
| T      | 2-2.備考                                   | String   | 返却時備考                   | 修理完了                       |
| U      | 2-3.修理の必要性                           | String   | 修理要否                     | 要修理                         |
| V      | 2-4.備考                                   | String   | 修理関連備考                 | トナー交換必要                 |
| W      | 3-0.社内ステータス                         | String   | 社内での状態                 | 修理待ち                       |
| X      | 3-0-1.棚卸フラグ                           | String   | 棚卸し対象フラグ             | 対象                           |
| Y      | 3-0-2.拠点                                 | String   | 現在の拠点                   | 大阪                           |
| Z      | 3-1-1.備考                                 | String   | 社内ステータス備考           | 部品待ち                       |
| AA     | 3-2-1.修理依頼の引継ぎ                     | String   | 修理引継ぎ情報               | 実施済み                       |
| AB     | 3-2-2.症状                                 | String   | 故障症状                     | 印刷不良                       |
| AC     | 3-2-3.備考                                 | String   | 修理引継ぎ備考               | メーカー修理必要               |
| AD     | 4-1. 所在                                  | String   | 修理時所在地                 | 修理センター                   |
| AE     | 4-2.修理内容                               | String   | 修理内容                     | ドラム交換                     |
| AF     | 4-3.備考                                   | String   | 修理備考                     | 保証期間内                     |
| AG     | 5-1.所在                                   | String   | 持ち出し所在                 | 本社                           |
| AH     | 5-2.持ち出し理由                           | String   | 持ち出し理由                 | 客先デモ                       |
| AI     | 5-3.備考                                   | String   | 持ち出し備考                 | 2024/07/20 返却予定            |
| AJ     | 6-1.所在                                   | String   | 廃棄時所在                   | 廃棄場                         |
| AK     | 6-2.依頼者                                 | String   | 廃棄依頼者                   | 管理部                         |
| AL     | 6-3.備考                                   | String   | 廃棄備考                     | 適正廃棄完了                   |
| AM     | 7-1.内容                                   | String   | その他内容                   | 特記事項なし                   |
| AN     | 7-2.所在                                   | String   | その他所在                   | 支店倉庫                       |
| AO     | 7-3.備考                                   | String   | その他備考                   | 要確認                         |
| AP     | 貸出日数                                   | Number   | 計算フィールド               | 貸出中の場合の経過日数         | 30                            |
| AQ     | 要注意フラグ                               | Boolean  | 計算フィールド               | 長期貸出等の注意が必要な状態   | FALSE                         |
| AR     | 拠点名                                     | String   | 拠点マスタ参照               | 拠点コードから拠点名を取得     | 大阪営業所                    |
| AS     | 管轄                                       | String   | 拠点マスタ参照               | 拠点の管轄エリア               | 関西                          |
| AT     | formURL                                    | String   | マスタ                       | 個別フォーム URL               | https://forms.google.com/...  |
| AU     | QR コード URL                              | String   | マスタ                       | QR コード用 URL                | https://script.google.com/... |

##### プリンタ・その他系の特徴

- **簡略化表示**: 端末系で必要なソフトウェア・OS 情報を除外
- **保守重視**: 修理・メンテナンス情報を重視した構造
- **効率的管理**: プリンタ特有の管理要件に特化

#### 5.1.3 旧統合ビューシート（integrated_view）【非推奨】

##### 概要

分離前の全機器統合ビュー。2025 年 1 月以降は非推奨とし、新規実装では端末系・プリンタ系の分離版を使用することを推奨。

##### 移行方針

- 既存システムとの互換性維持のため当面存続
- 新機能開発は分離版を対象とする
- データタイプマスタで「非推奨」フラグを設定


### 5.2 検索インデックスシート（search_index）

#### 概要

高速検索のために最適化されたインデックスシート。主要な検索キーと表示に必要な最小限のデータのみを保持。

#### 列構造

| 列番号 | 列名         | データ型 | 説明                             | 例                                              |
| ------ | ------------ | -------- | -------------------------------- | ----------------------------------------------- |
| A      | 拠点管理番号 | String   | プライマリキー                   | OSAKA_SV_ThinkPad_ABC123_001                    |
| B      | カテゴリ     | String   | 機器分類（インデックス化）       | Server                                          |
| C      | 機種名       | String   | 機種名（インデックス化）         | ThinkPad X1 Carbon                              |
| D      | ステータス   | String   | 現在ステータス（インデックス化） | 1.貸出中                                        |
| E      | 拠点コード   | String   | 拠点識別子（インデックス化）     | OSAKA                                           |
| F      | 管轄         | String   | 管轄エリア（インデックス化）     | 関西                                            |
| G      | 最終更新     | DateTime | ソート用日時                     | 2024/07/02 14:30:00                             |
| H      | 検索キー     | String   | 全文検索用結合フィールド         | OSAKA_SV_ThinkPad_ABC123_001 Server ThinkPad... |


### 5.3 サマリービューシート（summary_view）

#### 概要

管轄・拠点・カテゴリ別の集計データを提供するビューシート。ダッシュボード表示用に最適化。

#### 列構造

| 列番号 | 列名     | データ型 | 説明                     | 例         |
| ------ | -------- | -------- | ------------------------ | ---------- |
| A      | 管轄     | String   | 管轄エリア               | 関西       |
| B      | 拠点名   | String   | 拠点名称                 | 大阪営業所 |
| C      | カテゴリ | String   | 機器カテゴリ             | Server     |
| D      | 総数     | Number   | 機器総数                 | 50         |
| E      | 貸出中   | Number   | 貸出中の機器数           | 20         |
| F      | 社内保管 | Number   | 社内保管中の機器数       | 25         |
| G      | 修理中   | Number   | 修理中の機器数           | 3          |
| H      | その他   | Number   | その他ステータスの機器数 | 2          |
| I      | 稼働率   | Percent  | 貸出中/総数の割合        | 40.0%      |
| J      | 要注意数 | Number   | 注意が必要な機器数       | 5          |
| K      | 最終更新 | DateTime | データ最終更新日時       | 2024/07/02 |


### 5.4 ビューシート更新システム

#### 5.4.1 更新方式：リアルタイム更新型

##### 概要
統合ビューシートはリアルタイム更新型を採用し、ステータス変更時に即座に反映される。フォーム送信のonFormSubmitトリガーと連動して、最新情報を常に提供する。

##### 更新頻度
- **即時更新**：フォーム送信時（onFormSubmitトリガー）
- **自動更新**：ステータス変更検知時
- **バックアップ更新**：深夜2:00の日次全体更新

##### 更新対象
1. **端末系統合ビュー**（integrated_view_terminal）
2. **プリンタ・その他系統合ビュー**（integrated_view_printer_other）
3. **検索インデックス**（search_index）

##### トリガー設定
| トリガータイプ | 実行タイミング | 対象関数 | 説明 |
| -------------- | -------------- | -------- | ---- |
| onFormSubmit | フォーム送信時 | updateIntegratedViewOnSubmit | 提出された機器の統合ビューを即座に更新 |
| onChange | シート変更時 | updateIntegratedViewOnChange | マスタシート変更時の自動反映 |
| timeBased | 深夜2:00 | rebuildAllIntegratedViews | 日次全体再構築（バックアップ） |

##### データ取得元の詳細

| データソース | 取得データ | 対象統合ビュー | 取得方法 |
| ------------ | ---------- | -------------- | -------- |
| 端末マスタ | A～G列（基本情報） | 端末系統合ビュー | 拠点管理番号でVLOOKUP |
| プリンタマスタ | A～D列（基本情報） | プリンタ・その他系統合ビュー | 拠点管理番号でVLOOKUP |
| その他マスタ | A～D列（基本情報） | プリンタ・その他系統合ビュー | 拠点管理番号でVLOOKUP |
| 端末ステータス収集 | H～AN列（フォームデータ） | 端末系統合ビュー | 拠点管理番号の最新レコード |
| プリンタステータス収集 | E～AO列（フォームデータ） | プリンタ・その他系統合ビュー | 拠点管理番号の最新レコード |
| 拠点マスタ | 拠点名・管轄情報 | 両統合ビュー | 拠点コードでVLOOKUP |
| 機種マスタ | 機種名情報 | 両統合ビュー | 機種名でVLOOKUP |

##### 更新処理フロー
1. **フォーム送信検知**
   - 送信された拠点管理番号を特定
   - 拠点管理番号から機器カテゴリを判定
     - 拠点管理番号パターン：`拠点_カテゴリ_モデル_製造番号_連番`
     - カテゴリコード判定：SV/CL → 端末系、PR/OT → プリンタ・その他系
   - 該当する統合ビューのみ部分更新

2. **マスタデータ取得**
   - **端末系の場合**：
     ```
     端末マスタ.拠点管理番号 = 送信データ.拠点管理番号
     → A～G列データを取得
     ```
   - **プリンタ・その他系の場合**：
     ```
     プリンタマスタ.拠点管理番号 = 送信データ.拠点管理番号
     または
     その他マスタ.拠点管理番号 = 送信データ.拠点管理番号
     → A～D列データを取得
     ```

3. **収集シートデータ取得**
   - **最新ステータス特定**：
     ```
     WHERE 拠点管理番号 = 対象機器
     ORDER BY タイムスタンプ DESC
     LIMIT 1
     ```
   - **端末系**：端末ステータス収集シートからH～AN列
   - **プリンタ・その他系**：プリンタステータス収集シートからE～AO列

4. **計算フィールド生成**
   - **貸出日数**：現在日時 - 貸出開始日時
   - **要注意フラグ**：貸出日数 ≥ 90日 OR 修理期間 ≥ 30日

5. **参照データ取得**
   - **拠点情報**：拠点マスタから拠点名・管轄を取得
   - **機種情報**：機種マスタから詳細機種名を取得

6. **統合ビュー更新**
   - 対象行の特定：拠点管理番号で検索
   - 行全体の置換更新
   - 新規機器の場合：行末に追加

7. **検索インデックス更新**
   - 該当機器のインデックス行を特定
   - 検索キーの再生成：`拠点管理番号 + カテゴリ + 機種名 + ステータス + 管轄`
   - インデックス行の更新

##### パフォーマンス最適化
- **部分更新**：変更された行のみ処理
- **非同期処理**：複数機器の同時更新時の競合回避
- **エラーハンドリング**：更新失敗時の自動リトライ

##### 制限事項
- Google Apps Script実行時間制限：6分
- 同時実行制限：30トリガー
- 1日あたりのトリガー実行制限：20,000回

##### 監視・ログ
- 更新成功/失敗のログ記録
- 処理時間の監視
- エラー発生時の通知機能

#### 5.4.2 データ連携の詳細

##### マスタシートとの連携
| マスタシート | 連携トリガー | 更新対象 | 更新方法 |
| ------------ | ------------ | -------- | -------- |
| 拠点マスタ | onChange | AQ列（拠点名）、AR列（管轄） | 全統合ビューの該当拠点データを一括更新 |
| 機種マスタ | onChange | C列（機種名） | 該当機種を使用する全機器の機種名を更新 |
| 端末マスタ | onChange | A～G列（基本情報） | 該当機器の端末系統合ビュー行を更新 |
| プリンタマスタ | onChange | A～D列（基本情報） | 該当機器のプリンタ系統合ビュー行を更新 |
| その他マスタ | onChange | A～D列（基本情報） | 該当機器のプリンタ系統合ビュー行を更新 |

##### 収集シートとの連携
| 収集シート | 連携トリガー | 更新対象 | データ特定方法 |
| ---------- | ------------ | -------- | -------------- |
| 端末ステータス収集 | onFormSubmit | 端末系統合ビューH～AN列 | 拠点管理番号で特定、タイムスタンプ最新 |
| プリンタステータス収集 | onFormSubmit | プリンタ系統合ビューE～AO列 | 拠点管理番号で特定、タイムスタンプ最新 |

##### データ優先順位
1. **収集シートデータ**：最新のタイムスタンプを持つレコード
2. **マスタシートデータ**：基本情報（拠点管理番号が一致するもの）
3. **計算フィールド**：リアルタイム計算
4. **参照データ**：関連マスタからの動的取得

##### エラーハンドリング
- **マスタデータ未存在**：エラーログ記録、空値で継続処理
- **収集データ重複**：最新タイムスタンプを優先
- **参照データ不整合**：デフォルト値で代替

#### 5.4.3 リアルタイム更新の利点

##### 業務効率向上
- 貸出・返却の即時反映により在庫管理精度が向上
- 緊急対応時の迅速な状況把握が可能
- 重複貸出や紛失リスクの軽減

##### データ品質向上
- 最新ステータスの確実な反映
- 手動更新による人的ミスの排除
- データの一貫性保証

#### 5.4.4 運用上の注意点

##### システム負荷管理
- 大量同時更新時の処理時間監視
- Google Apps Script制限値の把握
- 必要に応じた処理の分散実行

##### エラー対応
- ネットワーク障害時の自動リトライ
- 部分更新失敗時のロールバック
- 管理者への自動通知

### 5.5 ビューシート管理

#### 5.5.1 定期メンテナンス

##### 日次メンテナンス
- 深夜2:00：全統合ビューの完全再構築
- データ整合性チェック
- エラーログの確認

##### 週次メンテナンス
- 検索インデックスの最適化
- パフォーマンス統計の分析
- 不要データの削除

##### 月次メンテナンス
- システム全体のパフォーマンス分析
- 容量使用量の確認
- バックアップデータの管理

#### 5.5.2 監視項目

##### リアルタイム監視
- 更新処理の実行時間
- エラー発生率
- トリガー実行回数

##### 定期監視
- データ品質チェック
- 重複データの検出
- システム全体の応答時間
