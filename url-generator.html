<!-- url-generator.html - 共通フォームURL生成ページ -->
<div class="url-generator-container">
  <div class="page-header">
    <h1><i class="fas fa-link"></i> 共通フォームURL生成</h1>
    <p>拠点管理番号を共通フォームURLに追加してマスタデータに保存します</p>
  </div>

  <!-- URL生成セクション -->
  <div class="url-generation-section">
    <div class="section-header">
      <h2><i class="fas fa-magic"></i> URL生成・保存</h2>
      <p>拠点管理番号とデバイスカテゴリを指定して、個別URLを生成します</p>
    </div>

    <!-- デバッグボタン（一時的） -->
    <div style="margin-bottom: 20px; padding: 10px; background: #f0f0f0; border-radius: 5px;">
      <button type="button" class="btn btn-secondary" onclick="testLoadLocations()" style="margin-right: 10px;">
        <i class="fas fa-sync"></i> 拠点データ再読み込み
      </button>
      <button type="button" class="btn btn-secondary" onclick="testLocationMasterBackend()">
        <i class="fas fa-bug"></i> 拠点マスタテスト（バックエンド）
      </button>
      <button type="button" class="btn btn-secondary" onclick="testDirectAddOption()" style="margin-left: 10px;">
        <i class="fas fa-plus"></i> 直接オプション追加テスト
      </button>
      <button type="button" class="btn btn-secondary" onclick="checkSelectVisibility()" style="margin-left: 10px;">
        <i class="fas fa-eye"></i> 表示状態チェック
      </button>
      <button type="button" class="btn btn-secondary" onclick="recreateLocationSelect()" style="margin-left: 10px;">
        <i class="fas fa-redo"></i> SELECT再作成
      </button>
      <button type="button" class="btn btn-warning" onclick="convertCategoriesToEnglish()" style="margin-left: 10px;">
        <i class="fas fa-language"></i> カテゴリを英語に変換
      </button>
      <div id="debugOutput" style="margin-top: 10px; padding: 10px; background: white; border-radius: 5px; display: none; max-height: 200px; overflow-y: auto;">
        <pre id="debugContent" style="margin: 0; font-size: 12px;"></pre>
      </div>
    </div>

    <!-- 警告メッセージ -->
    <div class="generation-warning">
      <div class="warning-header">
        <i class="fas fa-exclamation-triangle"></i>
        <strong>重要な注意事項</strong>
      </div>
      <div class="warning-content">
        <ul>
          <li>生成されたURLは該当するマスタデータに<strong>自動保存</strong>されます</li>
          <li>既存のURLがある場合は<strong>上書き</strong>されます</li>
          <li>共通フォームURLが設定されていない場合は生成できません</li>
        </ul>
      </div>
    </div>

    <form id="urlGenerationForm" class="generation-form">
      <!-- 拠点管理番号自動生成フィールド -->
      <div class="form-section">
        <h3 class="form-section-title">
          <i class="fas fa-info-circle"></i>
          拠点管理番号の生成
        </h3>
        <p class="form-section-description">以下の情報を入力すると、拠点管理番号が自動的に生成されます</p>
        
        <div class="form-grid">
          <!-- 拠点選択 -->
          <div class="form-group">
            <label for="location">
              <i class="fas fa-map-marker-alt"></i>
              拠点 <span class="required">*</span>
            </label>
            <select id="location" name="location" required onchange="updateLocationNumber()">
              <option value="">拠点を選択してください</option>
            </select>
            <small class="help-text">代替機を管理する拠点を選択してください</small>
          </div>

          <!-- デバイスカテゴリ選択 -->
          <div class="form-group">
            <label for="deviceCategory">
              <i class="fas fa-tag"></i>
              デバイスカテゴリ <span class="required">*</span>
            </label>
            <select id="deviceCategory" name="deviceCategory" required onchange="updateCategoryInfo(); loadModels(); updateLocationNumber()">
              <option value="">カテゴリを選択してください</option>
            </select>
            <small class="help-text">
              <span id="categoryHelp">選択したカテゴリに応じた共通フォームURLが使用されます</span>
            </small>
          </div>

          <!-- モデル選択 -->
          <div class="form-group">
            <label for="model">
              <i class="fas fa-laptop"></i>
              モデル <span class="required">*</span>
            </label>
            <select id="model" name="model" required onchange="updateLocationNumber()" disabled>
              <option value="">先にカテゴリを選択してください</option>
            </select>
            <small class="help-text">選択したカテゴリのモデルが表示されます</small>
          </div>

          <!-- 製造番号入力 -->
          <div class="form-group">
            <label for="serialNumber">
              <i class="fas fa-barcode"></i>
              製造番号 <span class="required">*</span>
            </label>
            <input type="text" id="serialNumber" name="serialNumber" required
              placeholder="例: ABC123456" 
              pattern="[A-Za-z0-9-]+"
              title="英数字とハイフンのみ使用可能"
              onchange="updateLocationNumber()" oninput="updateLocationNumber()">
            <small class="help-text">機器の製造番号を入力してください</small>
          </div>

          <!-- 連番入力 -->
          <div class="form-group">
            <label for="sequenceNumber">
              <i class="fas fa-sort-numeric-up"></i>
              連番 <span class="required">*</span>
            </label>
            <input type="number" id="sequenceNumber" name="sequenceNumber" required
              min="1" max="999" value="1"
              onchange="updateLocationNumber()" oninput="updateLocationNumber()">
            <small class="help-text">同一製造番号の機器がある場合の連番</small>
          </div>

          <!-- 自動生成された拠点管理番号 -->
          <div class="form-group full-width">
            <label for="locationNumber">
              <i class="fas fa-key"></i>
              生成された拠点管理番号
            </label>
            <input type="text" id="locationNumber" name="locationNumber" readonly
              placeholder="上記の情報を入力すると自動生成されます"
              class="generated-field">
            <small class="help-text">形式: 拠点_カテゴリ_モデル_製造番号_連番</small>
          </div>
        </div>
      </div>

      <!-- カテゴリ情報表示 -->
      <div id="categoryInfo" class="category-info" style="display: none;">
        <div class="info-header">
          <i class="fas fa-info-circle"></i>
          <span id="categoryInfoTitle">選択されたカテゴリ情報</span>
        </div>
        <div class="info-content">
          <p><strong>使用される共通フォーム:</strong> <span id="formTypeText"></span></p>
          <p><strong>保存先マスタ:</strong> <span id="masterTypeText"></span></p>
          <p><strong>共通URL設定状況:</strong> <span id="urlStatusText">確認中...</span></p>
        </div>
      </div>

      <!-- 生成・保存ボタン -->
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" onclick="resetForm()">
          <i class="fas fa-undo"></i>
          リセット
        </button>
        <button type="button" class="btn btn-primary" onclick="generateAndSaveUrl()">
          <i class="fas fa-magic"></i>
          URL生成・保存
        </button>
      </div>
    </form>
  </div>

  <!-- 結果表示セクション -->
  <div id="resultSection" class="result-section" style="display: none;">
    <div class="section-header">
      <h2><i class="fas fa-check-circle"></i> 生成結果</h2>
    </div>

    <div id="resultContent" class="result-content">
      <!-- 動的に結果が表示されます -->
    </div>

    <div class="result-actions">
      <button type="button" class="btn btn-info" onclick="copyUrlToClipboard()">
        <i class="fas fa-copy"></i>
        URLをコピー
      </button>
      <button type="button" class="btn btn-success" onclick="openGeneratedUrl()" id="openUrlBtn">
        <i class="fas fa-external-link-alt"></i>
        URLを開く
      </button>
    </div>
  </div>

  <!-- 成功メッセージ -->
  <div id="success-message" class="success-message" style="display: none;">
    <i class="fas fa-check-circle"></i>
    <span id="success-text">処理が完了しました</span>
  </div>

  <!-- エラーメッセージ -->
  <div id="error-message" class="error-message" style="display: none;">
    <i class="fas fa-exclamation-triangle"></i>
    <span id="error-text">エラーが発生しました</span>
  </div>
</div>