# ビューシート機能ガイド

## 概要

ビューシート機能は、代替機管理システムのデータを様々な視点から効率的に閲覧・検索できる機能です。以下の3つのビューを提供します：

1. **統合ビュー** - マスタデータとステータスデータを統合した最新状態
2. **検索インデックス** - 高速検索に最適化されたインデックス
3. **サマリービュー** - 管轄・拠点・カテゴリ別の集計データ

## セットアップ手順

### 1. 完全自動セットアップ（推奨）

Google Apps Scriptエディタで以下の関数を実行するだけで、全ての設定が完了します：

```javascript
setupViewSheetFeatureComplete()
```

これにより以下が自動的に行われます：
- データタイプマスタへの登録
- ビューシートの作成
- 初期データの構築
- 自動更新トリガーの設定（5分ごと）

### 2. 手動セットアップ

個別に設定したい場合は、以下の順番で関数を実行してください：

```javascript
// 1. データタイプを登録
initializeViewSheetDataTypes()

// 2. ビューシートを構築
initializeBuildViewSheets()

// 3. 自動更新トリガーを設定（オプション）
setupViewSheetUpdateTrigger()
```

## 使い方

### Webアプリケーションでの使用

1. **データタイプ選択**
   - プルダウンメニューから「統合ビュー」「検索インデックス」「サマリービュー」を選択

2. **フィルタリング**
   - 管轄、拠点、ステータスなどで絞り込み可能
   - 検索インデックスではキーワード検索が可能

3. **データ更新**
   - 「更新」ボタンをクリックして最新データを取得
   - 自動更新は5分ごとに実行されます

### 各ビューの特徴

#### 統合ビュー (integrated_view)
- **用途**: 機器の詳細情報を確認
- **表示内容**: 拠点管理番号、カテゴリ、機種名、現在ステータス、貸出情報など
- **フィルター**: 管轄、拠点、ステータス、カテゴリ

#### 検索インデックス (search_index)
- **用途**: キーワードで素早く機器を検索
- **表示内容**: 主要情報のみ（高速化のため）
- **検索対象**: 拠点管理番号、カテゴリ、機種名、ステータス、管轄

#### サマリービュー (summary_view)
- **用途**: 全体の状況を把握
- **表示内容**: 管轄・拠点・カテゴリ別の集計
- **集計項目**: 総数、貸出中、社内保管、修理中、稼働率、要注意数

## メンテナンス

### データの手動更新

```javascript
// 統合ビューを更新
buildIntegratedViewData()

// 検索インデックスを再構築
rebuildSearchIndex()

// サマリービューを更新
buildSummaryViewData()
```

### 状態確認

```javascript
// データタイプの登録状態を確認
checkViewSheetDataTypes()

// ビューシートの存在確認
testViewSheets()
```

### トラブルシューティング

1. **データが表示されない場合**
   - 統合ビューにデータがあるか確認
   - `buildIntegratedViewData()` を実行してデータを構築

2. **検索が機能しない場合**
   - 検索インデックスを再構築: `rebuildSearchIndex()`

3. **自動更新が動作しない場合**
   - トリガーを再設定: `setupViewSheetUpdateTrigger()`

## 技術仕様

### シート構造

#### 統合ビュー
- 26列（A〜Z）のデータ
- マスタデータとステータスデータを結合
- 貸出日数や要注意フラグなど計算フィールドを含む

#### 検索インデックス
- 8列の最小構成
- 検索キー列に全文検索用のテキストを格納
- 5分ごとに自動更新

#### サマリービュー
- 11列の集計データ
- リアルタイムで稼働率を計算
- 管轄→拠点→カテゴリの階層で集計

### パフォーマンス

- 統合ビュー: 数千件のデータを処理可能
- 検索インデックス: ミリ秒単位の高速検索
- サマリービュー: 即座に全体像を把握

## 今後の拡張予定

- [ ] エクスポート機能の追加
- [ ] より詳細なフィルタリング条件
- [ ] グラフ表示機能
- [ ] カスタムビューの作成機能